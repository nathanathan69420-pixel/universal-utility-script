local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Universal Utility",
    LoadingTitle = "Educational Purposes Only ;)",
    LoadingSubtitle = "Like And Subscribe",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "UniversalUtilityConfigs",
        FileName = "Settings"
    }
})

local MovementTab = Window:CreateTab("Movement", 4483362458)
local VisualsTab = Window:CreateTab("Visuals", 4483362458)

local WalkspeedEnabled = false
local CurrentWalkspeed = 16
local LoopConnection
local NoclipEnabled = false
local NoclipConnection
local FlyEnabled = false
local FlyConnection
local FlySpeed = 2
local BodyVel
local BodyGyro

local function StopLoop()
    if LoopConnection then
        LoopConnection:Disconnect()
        LoopConnection = nil
    end
end

local function StartLoop()
    StopLoop()
    LoopConnection = game:GetService("RunService").Heartbeat:Connect(function()
        local player = game.Players.LocalPlayer
        local char = player and player.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if WalkspeedEnabled and hum then
            hum.WalkSpeed = CurrentWalkspeed
        end
    end)
end

local WalkspeedSlider = MovementTab:CreateSlider({
    Name = "Walkspeed",
    Range = {16, 100},
    Increment = 1,
    CurrentValue = 16,
    Flag = "WalkspeedValue",
    Callback = function(Value)
        CurrentWalkspeed = Value
    end
})

local WalkspeedToggle = MovementTab:CreateToggle({
    Name = "Enable Walkspeed",
    CurrentValue = false,
    Flag = "WalkspeedEnabled",
    Callback = function(Value)
        WalkspeedEnabled = Value
        if Value then
            StartLoop()
        else
            StopLoop()
        end
    end
})

local function StopNoclip()
    if NoclipConnection then
        NoclipConnection:Disconnect()
        NoclipConnection = nil
    end
end

local function StartNoclip()
    StopNoclip()
    NoclipConnection = game:GetService("RunService").Stepped:Connect(function()
        local char = game.Players.LocalPlayer.Character
        if NoclipEnabled and char then
            for _, part in pairs(char:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end
        end
    end)
end

local NoclipToggle = MovementTab:CreateToggle({
    Name = "Noclip",
    CurrentValue = false,
    Flag = "NoclipEnabled",
    Callback = function(Value)
        NoclipEnabled = Value
        if Value then
            StartNoclip()
        else
            StopNoclip()
        end
    end
})

local function StopFly()
    if FlyConnection then
        FlyConnection:Disconnect()
        FlyConnection = nil
    end
    local char = game.Players.LocalPlayer.Character
    if char then
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if hrp then
            if BodyVel then BodyVel:Destroy() BodyVel = nil end
            if BodyGyro then BodyGyro:Destroy() BodyGyro = nil end
        end
    end
end

local function StartFly()
    StopFly()
    local player = game.Players.LocalPlayer
    local char = player.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    BodyVel = Instance.new("BodyVelocity")
    BodyVel.MaxForce = Vector3.new(1e5, 1e5, 1e5)
    BodyVel.Velocity = Vector3.zero
    BodyVel.Parent = hrp

    BodyGyro = Instance.new("BodyGyro")
    BodyGyro.MaxTorque = Vector3.new(1e5, 1e5, 1e5)
    BodyGyro.CFrame = hrp.CFrame
    BodyGyro.P = 1e4
    BodyGyro.Parent = hrp

    FlyConnection = game:GetService("RunService").Heartbeat:Connect(function()
        if FlyEnabled and hrp then
            local cam = workspace.CurrentCamera
            local dir = Vector3.zero
            local uis = game:GetService("UserInputService")

            if uis:IsKeyDown(Enum.KeyCode.W) then dir = dir + cam.CFrame.LookVector end
            if uis:IsKeyDown(Enum.KeyCode.S) then dir = dir - cam.CFrame.LookVector end
            if uis:IsKeyDown(Enum.KeyCode.A) then dir = dir - cam.CFrame.RightVector end
            if uis:IsKeyDown(Enum.KeyCode.D) then dir = dir + cam.CFrame.RightVector end
            if uis:IsKeyDown(Enum.KeyCode.Space) then dir = dir + Vector3.new(0,1,0) end
            if uis:IsKeyDown(Enum.KeyCode.LeftShift) then dir = dir + Vector3.new(0,-1,0) end

            if dir.Magnitude > 0 then
                BodyVel.Velocity = dir.Unit * FlySpeed * 10
            else
                BodyVel.Velocity = Vector3.zero
            end

            BodyGyro.CFrame = cam.CFrame
        end
    end)
end

local FlyToggle = MovementTab:CreateToggle({
    Name = "Fly",
    CurrentValue = false,
    Flag = "FlyEnabled",
    Callback = function(Value)
        FlyEnabled = Value
        if Value then
            StartFly()
        else
            StopFly()
        end
    end
})

local FlySpeedSlider = MovementTab:CreateSlider({
    Name = "Fly Speed",
    Range = {1, 10},
    Increment = 1,
    CurrentValue = 2,
    Flag = "FlySpeedValue",
    Callback = function(Value)
        FlySpeed = Value
    end
})

task.delay(0.1, function()
    WalkspeedToggle:Set(false)
    NoclipToggle:Set(false)
    FlyToggle:Set(false)
    WalkspeedSlider:Set(16)
    FlySpeedSlider:Set(2)
    CurrentWalkspeed = 16
    FlySpeed = 2
    StopLoop()
    StopNoclip()
    StopFly()
end)
