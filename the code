local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

local Window = Rayfield:CreateWindow({
    Name = "Universal Utility Script",
    LoadingTitle = "This was made for educational purposes ;)",
    LoadingSubtitle = "Like and Subscribe",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "UniversalUtilityConfig",
        FileName = "Settings"
    }
})

local MovementTab = Window:CreateTab("Movement", 4483362458)
local VisualsTab = Window:CreateTab("Visuals", 4483362458)

-- WalkSpeed
local selectedSpeed = 16
local walkspeedEnabled = false
local originalWalkSpeed = nil

local function getHumanoid()
    if player.Character then
        return player.Character:FindFirstChildWhichIsA("Humanoid")
    end
end

RunService.Heartbeat:Connect(function()
    local humanoid = getHumanoid()
    if humanoid then
        if not originalWalkSpeed then originalWalkSpeed = humanoid.WalkSpeed end
        if walkspeedEnabled then
            humanoid.WalkSpeed = selectedSpeed
        else
            humanoid.WalkSpeed = originalWalkSpeed
        end
    end
end)

MovementTab:CreateSlider({
    Name = "WalkSpeed",
    Range = {16, 100},
    Increment = 0.5,
    Suffix = "Speed",
    CurrentValue = 16,
    Flag = "WalkSpeedSlider",
    Callback = function(Value)
        selectedSpeed = Value
    end,
})

MovementTab:CreateToggle({
    Name = "Enable WalkSpeed",
    CurrentValue = false,
    Flag = "WalkSpeedToggle",
    Callback = function(Value)
        walkspeedEnabled = Value
    end,
})

-- Visuals ESP
local espEnabled = false
local espColor = Color3.fromRGB(255,255,255)
local highlights = {}

VisualsTab:CreateToggle({
    Name = "Player ESP",
    CurrentValue = false,
    Flag = "PlayerESP",
    Callback = function(Value)
        espEnabled = Value
        for _, plr in pairs(Players:GetPlayers()) do
            if plr ~= player then
                local char = plr.Character
                if char then
                    local h = char:FindFirstChildWhichIsA("Humanoid")
                    if Value then
                        local highlight = Instance.new("Highlight")
                        highlight.Name = "ESPHighlight"
                        highlight.Adornee = char
                        highlight.FillColor = espColor
                        highlight.FillTransparency = 0.55
                        highlight.OutlineColor = espColor
                        highlight.OutlineTransparency = 0
                        highlight.Parent = char
                        highlights[char] = highlight

                        -- Nametag
                        local billboard = Instance.new("BillboardGui")
                        billboard.Name = "Nametag"
                        billboard.Adornee = char:FindFirstChild("Head")
                        billboard.Size = UDim2.new(0, 120, 0, 50)
                        billboard.StudsOffset = Vector3.new(0, 2.5, 0)
                        billboard.AlwaysOnTop = true

                        local frame = Instance.new("Frame")
                        frame.Size = UDim2.new(1, 0, 1, 0)
                        frame.BackgroundTransparency = 1
                        frame.Parent = billboard

                        local nameLabel = Instance.new("TextLabel")
                        nameLabel.Size = UDim2.new(1,0,0.6,0)
                        nameLabel.Position = UDim2.new(0,0,0,0)
                        nameLabel.BackgroundTransparency = 1
                        nameLabel.Text = plr.Name
                        nameLabel.TextColor3 = espColor
                        nameLabel.TextStrokeTransparency = 0
                        nameLabel.TextScaled = true
                        nameLabel.Parent = frame

                        local healthBar = Instance.new("Frame")
                        healthBar.Size = UDim2.new(1,0,0.2,0)
                        healthBar.Position = UDim2.new(0,0,0.75,0)
                        healthBar.BackgroundColor3 = Color3.fromRGB(0,255,0)
                        healthBar.BorderSizePixel = 0
                        healthBar.Parent = frame

                        billboard.Parent = workspace

                        RunService.RenderStepped:Connect(function()
                            if h.Health > 0 then
                                local percent = math.clamp(h.Health/h.MaxHealth,0,1)
                                healthBar.Size = UDim2.new(percent,0,0.2,0)
                                nameLabel.Text = plr.Name .. " | " .. math.floor(h.Health)
                            end
                        end)
                    else
                        if highlights[char] then highlights[char]:Destroy() highlights[char] = nil end
                        if char:FindFirstChild("Nametag") then char.Nametag:Destroy() end
                    end
                end
            end
        end
    end
})

VisualsTab:CreateColorPicker({
    Name = "ESP Color",
    CurrentColor = espColor,
    Flag = "ESPColor",
    Callback = function(Color)
        espColor = Color
        for _, h in pairs(highlights) do
            h.FillColor = Color
            h.OutlineColor = Color
        end
    end
})

Rayfield:LoadConfiguration()
