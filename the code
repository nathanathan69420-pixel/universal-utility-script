local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local player = Players.LocalPlayer

local Window = Rayfield:CreateWindow({
    Name = "Universal Utility Script",
    LoadingTitle = "This was made for educational purposes ;)",
    LoadingSubtitle = "Like and Subscribe",
    ConfigurationSaving = {Enabled=true,FolderName="UniversalUtilityConfig",FileName="Settings"}
})

local MovementTab = Window:CreateTab("Movement",4483362458)
local VisualsTab = Window:CreateTab("Visuals",4483362458)

local walkspeedEnabled=false
local selectedSpeed=16
local noclipEnabled=false
local espEnabled=false
local chamsEnabled=false
local fullbrightEnabled=false
local highlights={}
local chamsParts={}
local walkLoop=nil
local originalLighting={
    Brightness=Lighting.Brightness,
    ClockTime=Lighting.ClockTime,
    FogEnd=Lighting.FogEnd,
    Ambient=Lighting.Ambient
}

local function getHumanoid()
    if player.Character then
        return player.Character:FindFirstChildWhichIsA("Humanoid")
    end
end

MovementTab:CreateSlider({Name="WalkSpeed",Range={16,100},Increment=0.5,Suffix="Speed",CurrentValue=16,Flag="WalkSpeedSlider",Callback=function(Value) 
    selectedSpeed=Value 
end})

MovementTab:CreateToggle({Name="Enable WalkSpeed",CurrentValue=false,Flag="WalkSpeedToggle",Callback=function(Value)
    walkspeedEnabled=Value
    if walkLoop then walkLoop:Disconnect() walkLoop=nil end
    if Value then
        walkLoop=RunService.Heartbeat:Connect(function()
            local humanoid = getHumanoid()
            if humanoid and walkspeedEnabled then
                humanoid.WalkSpeed=selectedSpeed
            end
        end)
    else
        local humanoid=getHumanoid()
        if humanoid then humanoid.WalkSpeed=16 end
    end
end})

MovementTab:CreateToggle({Name="NoClip",CurrentValue=false,Flag="NoClipToggle",Callback=function(Value) 
    noclipEnabled=Value 
end})

RunService.Heartbeat:Connect(function()
    if noclipEnabled and player.Character then
        for _,part in pairs(player.Character:GetDescendants()) do
            if part:IsA("BasePart") then part.CanCollide=false end
        end
    end
end)

local function getTeamColor(plr)
    if plr.Team == player.Team then
        return Color3.fromRGB(0,255,0)
    else
        return Color3.fromRGB(255,0,0)
    end
end

local function removeESP()
    for char,box in pairs(highlights) do
        if box and box.Parent then box:Destroy() end
    end
    highlights = {}
end

local function addESP(plr)
    local char = plr.Character
    if char and plr ~= player then
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if not hrp then return end

        local box = Instance.new("BoxHandleAdornment")
        box.Name = "ESPBox"
        box.Adornee = hrp
        box.AlwaysOnTop = true
        box.ZIndex = 10
        box.Transparency = 0.45
        box.Color3 = getTeamColor(plr)

        box.Size = Vector3.new(2, 5, 1)
        box.Parent = hrp
        highlights[char] = box
    end
end

VisualsTab:CreateToggle({Name="Player ESP",CurrentValue=false,Flag="PlayerESP",Callback=function(Value)
    espEnabled=Value
    if not Value then removeESP() else
        for _,plr in pairs(Players:GetPlayers()) do addESP(plr) end
    end
end})

local function removeChams()
    for char,parts in pairs(chamsParts) do
        for _,outline in pairs(parts) do
            if outline and outline.Parent then outline:Destroy() end
        end
    end
    chamsParts = {}
end

local function addChams(plr)
    local char=plr.Character
    if char and plr~=player then
        chamsParts[char]={}
        for _,part in pairs(char:GetDescendants()) do
            if part:IsA("BasePart") then
                local outline=Instance.new("Highlight")
                outline.Adornee=part
                outline.FillTransparency=0.55
                outline.OutlineColor=Color3.fromRGB(255,255,255)
                outline.OutlineTransparency=0
                outline.Parent=workspace
                table.insert(chamsParts[char],outline)
            end
        end
    end
end

VisualsTab:CreateToggle({Name="Chams",CurrentValue=false,Flag="ChamsToggle",Callback=function(Value)
    chamsEnabled=Value
    if not Value then removeChams() else
        for _,plr in pairs(Players:GetPlayers()) do addChams(plr) end
    end
end})

VisualsTab:CreateToggle({Name="FullBright",CurrentValue=false,Flag="FullBrightToggle",Callback=function(Value)
    fullbrightEnabled=Value
    if fullbrightEnabled then
        Lighting.Brightness=2
        Lighting.ClockTime=14
        Lighting.FogEnd=100000
        Lighting.Ambient=Color3.fromRGB(255,255,255)
    else
        Lighting.Brightness=originalLighting.Brightness
        Lighting.ClockTime=originalLighting.ClockTime
        Lighting.FogEnd=originalLighting.FogEnd
        Lighting.Ambient=originalLighting.Ambient
    end
end})

Players.PlayerAdded:Connect(function(plr)
    plr.CharacterAdded:Connect(function()
        if espEnabled then addESP(plr) end
        if chamsEnabled then addChams(plr) end
        local humanoid = getHumanoid()
        if walkspeedEnabled and humanoid then humanoid.WalkSpeed = selectedSpeed end
    end)
end)

Players.PlayerRemoving:Connect(function(plr)
    removeESP()
    removeChams()
end)

for _,plr in pairs(Players:GetPlayers()) do
    plr.CharacterAdded:Connect(function()
        if espEnabled then addESP(plr) end
        if chamsEnabled then addChams(plr) end
        local humanoid = getHumanoid()
        if walkspeedEnabled and humanoid then humanoid.WalkSpeed = selectedSpeed end
    end)
end

walkspeedEnabled=false
noclipEnabled=false
espEnabled=false
chamsEnabled=false
fullbrightEnabled=false
selectedSpeed=16
removeESP()
removeChams()
Lighting.Brightness=originalLighting.Brightness
Lighting.ClockTime=originalLighting.ClockTime
Lighting.FogEnd=originalLighting.FogEnd
Lighting.Ambient=originalLighting.Ambient
local humanoid=getHumanoid()
if humanoid then humanoid.WalkSpeed=16 end

Window:OnClose(function()
    local humanoid=getHumanoid()
    if humanoid then humanoid.WalkSpeed=16 end
    walkspeedEnabled=false
    noclipEnabled=false
    espEnabled=false
    chamsEnabled=false
    fullbrightEnabled=false
    removeESP()
    removeChams()
    Lighting.Brightness=originalLighting.Brightness
    Lighting.ClockTime=originalLighting.ClockTime
    Lighting.FogEnd=originalLighting.FogEnd
    Lighting.Ambient=originalLighting.Ambient
    if walkLoop then walkLoop:Disconnect() walkLoop=nil end
end)

Rayfield:LoadConfiguration()
